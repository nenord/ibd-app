<style media="screen">

  @media only screen and (max-width: 600px) {
  #small-hide, tr td:nth-child(2) { display:none; visibility:hidden; }
  }

  .table { max-width: 800px }

  .removable { max-width: 800px }

  .grayed-out { color: gray }

  #dont-hide { width: 50% }
  #small-hide { width: 30% }
  #dont-hide-button { width: 20% }

</style>
<div>
  <table id="table-1" class="table table-hover">
      <tr>
          <td id="dont-hide">
              <a href={{ restaurant['url'] }} target="_blank">
                  {{ restaurant['name']}}
              </a><br>
                  <p class="grayed-out">{{ restaurant['location']['city'] }}</p>
                  {% if restaurant['location']['address1'] %}
                  <p class="grayed-out">{{ restaurant['location']['address1'] }}, {{ restaurant['location']['postal_code'] }}</p>
                  {% else %}
                  <p class="grayed-out">{{ restaurant['location']['postal_code'] }}</p>
                  {% endif %}
          </td>
          <td id="small-hide">
              <p>Rating: {{ restaurant['rating'] }}</p>
              <p class="grayed-out">Based on {{ restaurant['review_count'] }} rating</p>
          </td>

          <td id="dont-hide-button"><br>
            <button type="button" id="{{ restaurant['alias'] }}" class="btn btn-primary pull-right">Recommend</button>
          </td>
      </tr>
  </table>
</div>

<div class="removable" id="{{ restaurant['alias'] }}">
  <input type="text" id='{{ restaurant['alias'] }}' class="form-control" aria-label="Default"
    aria-describedby="inputGroup-sizing-default" placeholder="Input less than 100 characters">
  <div>
    <button type="button" name='submit-it' id='{{ restaurant['alias'] }}' class="btn btn-light col-md-1"
      style="margin: 5px">Submit</button>
    <button type="button" name='cancel-it' id='{{ restaurant['alias'] }}' class="btn btn-light col-md-1"
      style="margin: 5px">Cancel</button><br>
  </div><br>
</div><br>

<script type="text/javascript">
  document.querySelector('[id="{{ restaurant['alias'] }}"][class="removable"]').style.display = 'none';
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelector('[id="{{ restaurant['alias'] }}"][class="btn btn-primary pull-right"]').onclick = function () {
      var div_toggle = document.querySelector('[id="{{ restaurant['alias'] }}"][class="removable"]');
      div_toggle.style.display = 'block';
      var buttons_toggle = document.querySelectorAll('.btn-primary');
      buttons_toggle.forEach(function(button) {
        button.disabled = true;
      });
      document.querySelector('[id="{{ restaurant['alias'] }}"][name="cancel-it"]').onclick = function () {
        buttons_toggle.forEach(function(button) {
          button.disabled = false;
        });
        div_toggle.style.display = 'none';
      }
      document.querySelector('[id="{{ restaurant['alias'] }}"][name="submit-it"]').onclick = function () {
        const post = document.querySelector('[id="{{ restaurant['alias'] }}"][type="text"]');
        if (post.value == '') {
          alert('You cannot post empty form.');
        }
        else if (post.value.length > 100) {
           alert('Input should be less than 100 characters.');
        }
        else {
          //const send_to_flask ='{{ restaurant.alias }}';
          var rest_info = {{restaurant|tojson}};
          const post_text = post.value;
          // Now rest_info is an object, need ot change back end to accept this object
          // Also uncomment ajax request below
          const request = new XMLHttpRequest();
          request.open('POST', '/addpost');
          request.onload = () => {
            const resp = JSON.parse(request.responseText);
            alert(resp.message);
          }
          const data = new FormData();
          data.append('post_text', post_text);
          data.append('name', rest_info.name);
          data.append('alias', rest_info.alias);
          data.append('url', rest_info.url);
          data.append('categories', JSON.stringify(rest_info.categories));
          data.append('city', rest_info.location.city);
          data.append('address', rest_info.location.address1);
          data.append('postal_code', rest_info.location.postal_code);
          data.append('country', rest_info.location.country);
          request.send(data);
          buttons_toggle.forEach(function(button) {
            button.disabled = false;
          });
          div_toggle.style.display = 'none';
          post.value = "";
          return false;
        }
      }
    }
  });
</script>
